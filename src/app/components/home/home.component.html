<main class="container mt-3 mb-4">
  <div class="filters d-flex justify-content-between align-items-center mb-4 px-3 flex-wrap">
    <div class="nav-links d-flex flex-wrap gap-3">
      <span
        [class.active]="(selectedCategory$ | async) === 'all'"
        (click)="filterProducts('all')"
        >All Products</span
      >
      <span
        [class.active]="(selectedCategory$ | async) === 'women'"
        (click)="filterProducts('women')"
        >Women</span
      >
      <span
        [class.active]="(selectedCategory$ | async) === 'men'"
        (click)="filterProducts('men')"
        >Men</span
      >
      <span
        [class.active]="(selectedCategory$ | async) === 'bag'"
        (click)="filterProducts('bag')"
        >Bag</span
      >
      <span
        [class.active]="(selectedCategory$ | async) === 'shoes'"
        (click)="filterProducts('shoes')"
        >Shoes</span
      >
      <span
        [class.active]="(selectedCategory$ | async) === 'watch'"
        (click)="filterProducts('watch')"
        >Watches</span
      >
    </div>

    <div class="d-flex  gap-2 flex-wrap">
      <button class="btn btn-outline-secondary btn-sm " (click)="toggleFilter()">
        <i class="bi bi-filter"></i> {{ showFilter ? "× Filter" : "Filter" }}
      </button>
      <button class="btn btn-outline-secondary btn-sm " (click)="toggleSearch()">
        <i class="bi bi-search"></i> {{ showSearch ? "× Search" : "Search" }}
      </button>
    </div>

  </div>

  <!-- Search -->
  <div *ngIf="showSearch" class="mb-4 px-5 py-2" [@fadeInOut]>
    <input
      class="form-control py-3"
      placeholder="Search products..."
      [(ngModel)]="searchTerm"
      (input)="onSearchChange()"
    />
  </div>

  <!-- Simple Filter panel -->
  <div *ngIf="showFilter" class="filter-box p-3 rounded mb-4" [@fadeInOut]>
    <div class="row">
      <div class="col-md-3 gap-4">
        <h6>Sort By</h6>
        <ul class="filter-item list-unstyled">
          <li
            (click)="applySort('default')"
            [ngClass]="{ 'active-filter': selectedSort === 'default' }"
            class="hover-default my-2"
          >
            Default
          </li>
          <li
            (click)="applySort('low-high')"
            [ngClass]="{ 'active-filter': selectedSort === 'low-high' }"
            class="hover-low-high my-2"
          >
            Price: Low to High
          </li>
          <li
            (click)="applySort('high-low')"
            [ngClass]="{ 'active-filter': selectedSort === 'high-low' }"
            class="hover-high-low my-2"
          >
            Price: High to Low
          </li>
        </ul>
      </div>

      <div class="col-md-3">
        <h6>Price</h6>
        <ul class="filter-item list-unstyled">
          <li
            (click)="applyPriceFilter(0, 50)"
            [ngClass]="{
              'active-filter':
                selectedPrice?.min === 0 && selectedPrice?.max === 50
            }"
          >
            $0 - $50
          </li>
          <li
            (click)="applyPriceFilter(50, 100)"
            [ngClass]="{
              'active-filter':
                selectedPrice?.min === 50 && selectedPrice?.max === 100
            }"
          >
            $50 - $100
          </li>
          <li
            (click)="applyPriceFilter(100, 200)"
            [ngClass]="{
              'active-filter':
                selectedPrice?.min === 100 && selectedPrice?.max === 200
            }"
          >
            $100 - $200
          </li>
          <li
            (click)="applyPriceFilter(200, 99999)"
            [ngClass]="{ 'active-filter': selectedPrice?.min === 200 }"
          >
            $200+
          </li>
        </ul>
      </div>

      <div class="col-md-3">
        <h6>Color</h6>
        <div
          *ngFor="let c of ['Black', 'Blue', 'Grey', 'Green', 'Red', 'White']"
        >
          <label
            [ngClass]="{ 'active-filter': selectedColor === c }"
            class="color-radio-label"
          >
            <input
              type="radio"
              name="color"
              (change)="applyColorFilter(c)"
              [checked]="selectedColor === c"
            />
            {{ c }}
          </label>
        </div>
        <div class="mt-2">
          <button class="clear-btn" (click)="applyColorFilter(null)">
            <i class="bi bi-x-circle"></i> Clear color
          </button>
        </div>
      </div>

      <div class="tags col-md-3">
        <h6>Tags</h6>
        <span
          *ngFor="
            let t of ['Fashion', 'Lifestyle', 'Denim', 'Streetstyle', 'Crafts']
          "
          class="tag-pill m-1"
          [class.active-pill]="selectedTag === t"
          (click)="applyTagFilter(t)"
        >
          {{ t }}
        </span>
        <div class="mt-2 d-flex gap-2">
          <button class="clear-btn" (click)="applyTagFilter(null)">
            <i class="bi bi-x-circle"></i> Clear tag
          </button>
          <button class="clear-btn" (click)="clearAllFilters()">
            <i class="bi bi-x-circle"></i> Clear all
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Product grid -->
  <div class="d-flex flex-wrap align-items-center gap-5">
    <ng-container *ngIf="!(showWishlist$ | async); else wishlistBlock">
      <div
        *ngFor="let product of products$ | async"
        style="width: 18rem"
        [@productAnimation]
      >
        <app-product-card [products]="product"></app-product-card>
      </div>
    </ng-container>
    <ng-template #wishlistBlock>
      <div
        *ngIf="(wishlist$ | async)?.length; else emptyWishlist"
        class="d-flex flex-wrap align-items-center gap-5"
      >
        <div
          *ngFor="let product of wishlist$ | async"
          style="width: 18rem"
          [@productAnimation]
        >
          <app-product-card [products]="product"></app-product-card>
        </div>
      </div>
      <ng-template #emptyWishlist>
        <div class="text-center w-100 text-muted py-5">
          <i class="far fa-heart fa-2x mb-2"></i><br />
          No products in your wishlist yet.
        </div>
      </ng-template>
    </ng-template>
  </div>
</main>
